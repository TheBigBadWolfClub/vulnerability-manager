FROM node:14

WORKDIR /opt/src/

COPY backend backend
COPY dump dump

RUN apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 9DA31620334BD75D9DCB49F368818C72E52529D4 && \
    apt-get update &&  apt install mongo-tools

RUN cd backend && npm i && \
    echo "" > .env && \
    echo "MONGO_USER=root" >> .env && \
    echo "MONGO_PASSWORD=mongo2020" >> .env && \
    echo "MONGO_DB=anygivenapp" >> .env && \
    echo "MONGO_DB_ADR=mongo" >> .env && \
    echo "MONGO_DB_PORT=27017" >> .env && \
    echo "MONGO_DOCKER=true" >> .env && \
    cd ..



#EXPOSE 8080
#CMD [ "node", "./backend/bin/www" ]
# mongorestore --host=mongo --username=root --password=MongoDB2020!
CMD mongorestore --host=mongo --username=root --password=mongo2020 ; node ./backend/bin/www
#ENTRYPOINT ["tail", "-f", "/dev/null"]
