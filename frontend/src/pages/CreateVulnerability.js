import React, {useState} from 'react'
import './CreateVulnerability.css'



function CreateVulnerability(props) {


  const [cveId, setCveId] = useState("");
  const [title, setTitle] = useState("");
  const [description, setDescription] = useState("");
  const [attackVector, setAttackVector] = useState("ADJACENT_NETWORK");
  const [attackComplexity, setAttackComplexity] = useState("HIGH");



  const handleSubmit = (event) => {
    event.preventDefault();
    console.log("submit")

    console.log(cveId)
    console.log(title)
    console.log(description)
    console.log(attackVector)
    console.log(attackComplexity)
    const requestBody = {
      query: `
      mutation {
  createVulnerability(vulnerabilityInput: {cveId:"${cveId}", title:"${title}", description:"${description}", attackVector:${attackVector}, attackComplexity:${attackComplexity}}) {
    _id
    }
  }
      `
    }

    fetch('http://localhost:8000/graphql', {
      method: 'POST',
      body: JSON.stringify(requestBody),
      headers: {
        'Content-Type': 'application/json',
        // Authorization: 'Bearer ' + token
      }
    }).then(res => {
      if (res.status !== 200 && res.status !== 201) {
        //throw new Error('Failed!');
      }
      return res.json();
    }).then(resData => {
      console.log(resData.data)
    }).catch(err => {
      console.log(err)
    })
  }

  return (
    <React.Fragment>
      <div>
        <header>Create new Vulnerability</header>
        <form onSubmit={handleSubmit}>
          <section className={'section-vulnerability'}>
            <label>CVSS Id:
              <input type="text"
                     onChange={e => setCveId(e.target.value)}
                     placeholder="Add CVE-ID"
                     name="cveId"
                     required
              />
            </label>

            <label>Title:
              <input type="text"
                     onChange={e => setTitle(e.target.value)}
                     placeholder="Add Title"
                     name="title"
                     required
              />
            </label>
          </section>
          <section className={'section-vulnerability-cvss'}>
            <label>AttackVector:
              <select required
                      onChange={e => setAttackVector(e.target.value)}
                      name="AttackVector">
                <option value={"ADJACENT_NETWORK"}>ADJACENT_NETWORK</option>
                <option value={"LOCAL"}>LOCAL</option>
                <option value={"NETWORK"}>NETWORK</option>
                <option value={"PHYSICAL"}>PHYSICAL</option>
              </select>
            </label>
            <label>AttackComplexity:
              <select required
                      onChange={e => setAttackComplexity(e.target.value)}
                      name="AttackComplexity">
                <option value={"HIGH"}>HIGH</option>
                <option value={"LOW"}>LOW</option>
              </select>
            </label>
          </section>
          <label>Description:
            <textarea
              onChange={e => setDescription(e.target.value)}
              placeholder="Add description"
              name="description"
              required
            />
          </label>
          <section className={'section-action'}>
            <button className={'btn'} type="submit">Confirm</button>
          </section>
        </form>
      </div>
    </React.Fragment>
  );
}

export default CreateVulnerability
