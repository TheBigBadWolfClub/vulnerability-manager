import React, {useState} from 'react'
import {useHistory} from 'react-router-dom';
import './Vulnerabilities.css'
import MaterialTable from "material-table";

import {tableQuery} from '../graphql/vulnerability'


function Vulnerabilities(props) {

  const history = useHistory();
  const [tableData, setTableData] = useState([]);

  React.useEffect(() => {
    fetch('http://localhost:8000/graphql', {
      method: 'POST',
      body: JSON.stringify(tableQuery),
      headers: {
        'Content-Type': 'application/json',
        // Authorization: 'Bearer ' + token
      }
    }).then(res => {
      if (res.status !== 200 && res.status !== 201) {
        throw new Error('Failed!');
      }
      return res.json();
    }).then(resData => {
      setTableData(resData.data.vulnerabilities)
      console.log(tableData)
    }).catch(err => {
      console.log(err)
    })

  }, []);

  const columns = [
    {
      title: "CveId",
      field: "cveId",
    },
    {
      title: "Title",
      field: "title",
    },
    {
      title: "vector",
      field: "cvss.attackVector",
    },
    {
      title: "Complexity",
      field: "cvss.attackComplexity",
    },{
      title: "Base Sev.",
      field: "cvssScores.baseSeverity",
    },{
      title: "Tmp. Sev.",
      field: "cvssScores.temporalSeverity",
    },{
      title: "Env. Sev.",
      field: "cvssScores.environmentalSeverity",
    }
  ];


  return (
    <React.Fragment>
      <div className={'vulnerabilities-table'}>

        <MaterialTable
          title="Vulnerabilities"
          data={tableData}
          columns={columns}
          options={{ search: false, paging: true, filtering: true, exportButton: false }}
          isLoading={false}
          actions={[
            {
              icon: 'visibility',
              tooltip: 'View/Edit',
              onClick: (event, rowData) => {
                history.push({
                  pathname: `/view/${rowData._id}`
                });
              }
            },
            {
              icon: 'delete',
              tooltip: 'Delete',
              onClick: (event, rowData) => console.log("You want to delete " + rowData.name)
            }
          ]}
        />
      </div>
    </React.Fragment>
  )
}

export default Vulnerabilities
