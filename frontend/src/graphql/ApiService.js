module.exports = {
  fetchWrapper: (jqlQuery) => {
    const auth = JSON.parse(localStorage.getItem('authData'));
    const token = auth ? auth.token : 'badToken'
    const header = {
      'Content-Type': 'application/json',
      Authorization: 'Bearer ' + token
    }
    return fetch('http://localhost:8080/graphql', {
      method: 'POST',
      body: JSON.stringify(jqlQuery),
      headers: header
    }).then(res => {
      if (res.status !== 200 && res.status !== 201) {
        throw new Error(`Failed: statusCode[${res.status}] text[${res.statusText}]`);
      }
      return res.json();
    })
      .then(resData => {
        if (resData.errors && resData.errors.length > 0) {
          throw new Error(`Error: ${resData.errors[0].message}`)
        }
        return resData;
      })
  }
}


