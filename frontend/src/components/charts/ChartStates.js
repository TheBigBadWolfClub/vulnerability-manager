import React from "react";
import BarChart from "recharts/lib/chart/BarChart";
import CartesianGrid from "recharts/lib/cartesian/CartesianGrid";
import XAxis from "recharts/lib/cartesian/XAxis";
import YAxis from "recharts/lib/cartesian/YAxis";
import Tooltip from "recharts/lib/component/Tooltip";
import Legend from "recharts/lib/component/Legend";
import Bar from "recharts/lib/cartesian/Bar";
import {fetchWrapper} from "../../graphql/ApiService";
import {chartState} from "../../graphql/vulnerability";
import {SnackBarCtx} from "../../context/SnackBarContext";
import Paper from "@material-ui/core/Paper";

import './ChartStates.css'

export default function ChartStates(props) {

    const [chartData, setChartData] = React.useState([]);
    const {state, dispatch} = React.useContext(SnackBarCtx);

    React.useEffect(() => {
        fetchWrapper(chartState)
            .then(resData => {
                const serverData = resData.data.vulnerabilities;
                const counter = serverData.reduce((r, row) => {
                    r[row.state] = ++r[row.state] || 1;
                    return r;
                }, {});
                setChartData([counter])
            })
            .catch(err => {
                dispatch({type: "OPEN", msg: `${err.message}`})
                console.log(err)
            })

        // eslint-disable-next-line react-hooks/exhaustive-deps
    }, []);

    return (
        <React.Fragment>
            <Paper elevation={2} className={'chart-paper'}>
                <label className={'chart-label'}>Vulnerabilities States</label>
                <BarChart
                    width={500}
                    height={300}
                    data={chartData}
                    barGap={30}
                    margin={{
                        top: 5, right: 30, left: 20, bottom: 5,
                    }}
                >
                    <CartesianGrid strokeDasharray="3 3"/>
                    <XAxis dataKey="name"/>
                    <YAxis/>
                    <Tooltip/>
                    <Legend/>
                    <Bar dataKey="OPEN" fill="red"/>
                    <Bar dataKey="PENDING" fill="orange"/>
                    <Bar dataKey="TESTING" fill="yellow"/>
                    <Bar dataKey="REVIEW" fill="greenyellow"/>
                    <Bar dataKey="FIXED" fill="green"/>
                </BarChart>
            </Paper>
        </React.Fragment>
    )

}
