import React from "react";
import BarChart from "recharts/lib/chart/BarChart";
import CartesianGrid from "recharts/lib/cartesian/CartesianGrid";
import XAxis from "recharts/lib/cartesian/XAxis";
import YAxis from "recharts/lib/cartesian/YAxis";
import Tooltip from "recharts/lib/component/Tooltip";
import Legend from "recharts/lib/component/Legend";
import Bar from "recharts/lib/cartesian/Bar";
import {fetchWrapper} from "../../graphql/ApiService";
import {chartState} from "../../graphql/vulnerability";
import {SnackBarCtx} from "../../context/SnackBarContext";
import Paper from "@material-ui/core/Paper";

import './ChartStates.css'
import RadarChart from "recharts/lib/chart/RadarChart";
import PolarGrid from "recharts/lib/polar/PolarGrid";
import PolarAngleAxis from "recharts/lib/polar/PolarAngleAxis";
import PolarRadiusAxis from "recharts/lib/polar/PolarRadiusAxis";
import Radar from "recharts/lib/polar/Radar";

export default function AttackVector(props) {

  const [chartData, setChartData] = React.useState([]);
  const {state, dispatch} = React.useContext(SnackBarCtx);
  React.useEffect(() => {
    fetchWrapper(chartState)
      .then(resData => {
        const serverData = resData.data.vulnerabilities;
        const result = serverData
          .map(v => v.cvss)
          .reduce((r, row) => {
            r[row.attackVector] = ++r[row.attackVector] || 1;
            return r;
          }, {});

        const counter = ['NETWORK', 'ADJACENT_NETWORK', 'LOCAL', 'PHYSICAL'].map(k => {
          return {type: k, count: result[k]};
        });

        setChartData(counter)
      })
      .catch(err => {
        dispatch({type: "OPEN", msg: `${err.message}`})
        console.log(err)
      })

    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);

  return (
    <React.Fragment>
      <Paper elevation={2} className={'chart-paper'}>
        <label className={'chart-label'}>Attack Vector</label>
        <RadarChart cx={250} cy={200} outerRadius={100} width={500} height={400} data={chartData}>
          <PolarGrid/>
          <PolarAngleAxis dataKey="type" tick={{fontSize: 10}}/>
          <PolarRadiusAxis/>
          <Radar name="AttackVector" dataKey="count" stroke="#8884d8" fill="#8884d8" fillOpacity={0.6}/>
          <Tooltip/>
        </RadarChart>
      </Paper>
    </React.Fragment>
  )

}
