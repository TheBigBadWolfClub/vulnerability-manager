const jwt = require('jsonwebtoken')
module.exports = {
    isAuthenticated: (req, res, next) => {
        const authHeader = req.get('Authorization');
        if (!authHeader) {
            req.isAuth = false;
            return next()
        }

        const token = authHeader.split(' ')[1]; //Bearer token
        if (!token || token === '') {
            req.isAuth = false;
            return next()
        }

        let decodedToken;
        try {
            decodedToken = jwt.verify(token, 'tokenhash')
        } catch (err) {
            req.isAuth = false;
            return next()
        }

        if (!decodedToken) {
            req.isAuth = false;
            return next()
        }

        req.isAuth = true
        req.userId = decodedToken.userId
        next();
    },
    allowCors: (req, res, next) => {
        res.setHeader('Access-Control-Allow-Origin', '*');
        res.setHeader('Access-Control-Allow-Methods', 'POST,GET,OPTIONS');
        res.setHeader('Access-Control-Allow-Headers', 'Content-Type, Authorization');
        if (req.method === 'OPTIONS') {
            return res.sendStatus(200);
        }
        next();
    }

}
