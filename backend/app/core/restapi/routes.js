const express = require('express');
const {STATUS_CODES} = require('http')
const {ApiError, buildError} = require('../app-error')
const logger = require("../logger");
const vulnerabilityRoutes = require("../../vulnerability/endpoint");
const userRoutes = require("../../user/endpoints");


const processError = async (err, req, res, next) => {
    let error = err;

    if (!(err instanceof ApiError)) {
        logger.error('API Error [undefined]:', err);
        error = buildError(err.code || 500, err.message || STATUS_CODES[error.code], err.stack);
    }
    logger.error('API Error [undefined]:', err);

    res.status(error.code)
        .send(error.getClientObject())
        .end();
};

const router = express.Router();
router.use(userRoutes)
router.use(vulnerabilityRoutes)
router.use((req, res) => {
    res.status(404).end();
})
router.use(processError);


module.exports = router;