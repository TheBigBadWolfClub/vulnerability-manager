const mongoose = require("mongoose");

module.exports = {
    connectMongo: async (addr, database, username, password, isDocker) => {
        console.log("Connecting to MongoDB...")
        if (isDocker) console.warn("expecting docker instance of mongoDB")

        const protocol = isDocker ? 'mongodb' : 'mongodb+srv'
        const options = isDocker ? 'authSource=admin&retryWrites=true&w=majority' : 'retryWrites=true&w=majority'
        const uriStr = `${protocol}://${username}:${password}@${addr}/${database}?${options}`
        try {
            await mongoose.connect(uriStr, {useNewUrlParser: true, useUnifiedTopology: true})
            console.log("Connected to MongoDB.")
        } catch (err) {
            console.log(`fail to connect to mongo DB: docker=${isDocker} connString=${protocol}://${username}:******@${addr}/${database}?${options}`);
            console.log(err);
            throw "Fail to connect to DB"
        }
    }
}