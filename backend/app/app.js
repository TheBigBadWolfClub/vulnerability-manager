/**
 * Express configuration to serve files and resources
 */


/**
 * add default configs for express
 */
const cookieParser = require('cookie-parser');
const logger = require('morgan');
const { allowCors} = require('./app-middlewares')
const express = require('express');
const expressApp = express();
expressApp.use(logger('dev'));
expressApp.use(express.json());
expressApp.use(express.urlencoded({extended: false}));
expressApp.use(cookieParser());
expressApp.use(allowCors);


/**
 * add processAuthHeader middleware
 */
const {processAuthHeader} = require('./app-middlewares')
expressApp.use(processAuthHeader)


/**
 * Serve graphql endpoint's
 */
const {graphqlHTTP} = require('express-graphql');
const graphQlSchema = require('./graphql/schema');
const graphQlResolvers = require('./graphql/resolver');
expressApp.use('/graphql', graphqlHTTP({
    schema: graphQlSchema,
    rootValue: graphQlResolvers,
    graphiql: true,
}));


/**
 * Serve static resources
 */
const path = require('path');
const staticPath = '../public'
expressApp.use(express.static(path.join(__dirname,staticPath)));
expressApp.use('/', express.static(path.join(__dirname, staticPath)));
expressApp.use('*', express.static(path.join(__dirname, staticPath)));

module.exports = expressApp;
